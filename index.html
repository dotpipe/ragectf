<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTF Chess Game</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="game-container">
        <h1>CTF Chess</h1>
        <div id="mode-selection">
            <button id="play-bot">Play Against Bot</button>
            <button id="play-human">Play Against Human</button>
        </div>
        <div id="chessboard"></div>
        <div id="game-info">
            <p>Current Player: <span id="current-player"></span></p>
            <p>Score: White <span id="white-score">0</span> - Black <span id="black-score">0</span></p>
        </div>
        <div id="chat-container" style="display: none;">
            <div id="chat-messages"></div>
            <input type="text" id="chat-input" placeholder="Type a message...">
            <button id="send-chat">Send</button>
        </div>
    </div>
    <script src="ctfchess.js"></script>
    <script src="movecache.js"></script>
    <script src="usermovecache.js"></script>
    <script src="ctfbot.js"></script>
    <script>
        let game, bot;
        const playBotButton = document.getElementById('play-bot');
        const playHumanButton = document.getElementById('play-human');
        const chatContainer = document.getElementById('chat-container');

        playBotButton.addEventListener('click', () => {
            game = new CTFChess();
            bot = new CTFBot(game, 'Black');
            initializeGame('bot');
        });

        playHumanButton.addEventListener('click', () => {
            game = new CTFChess();
            initializeGame('human');
            chatContainer.style.display = 'block';
        });

        function initializeGame(mode) {
            document.getElementById('mode-selection').style.display = 'none';
            game.print_board();
            updateGameInfo();

            const cells = document.querySelectorAll('#chessboard td');
            cells.forEach(cell => {
                cell.addEventListener('click', () => {
                    if (!game.selectedPiece) {
                        game.selectedPiece = { row: parseInt(cell.dataset.row), col: parseInt(cell.dataset.col) };
                    }
                    else if (game.selectedPiece && !game.moveTo) {
                        game.moveTo = { row: parseInt(cell.dataset.row), col: parseInt(cell.dataset.col) };
                    }
                    if (game.selectedPiece && game.moveTo && game.validate_move(cell.dataset.row, cell.dataset.col)) {
                        game.makeMove();
                        game.print_board();
                        updateGameInfo();
                        if (mode === 'bot' && game.currentPlayer === 'Black') {
                            setTimeout(() => {
                                const botMove = bot.makeMove();
                                game.selectedPiece = { row: botMove.from.row, col: botMove.from.col };
                                game.moveTo = { row: botMove.to.row, col: botMove.to.col };
                                game.makeMove();
                                game.print_board();
                                updateGameInfo();
                                game.selectedPiece = null;
                                game.moveTo = null;
                            }, 500);
                        }
                    }
                });
            });
        }

        function updateGameInfo() {
            document.getElementById('current-player').textContent = game.currentPlayer;
            document.getElementById('white-score').textContent = game.score.White;
            document.getElementById('black-score').textContent = game.score.Black;
        }

        // Add chat functionality for human vs human mode
        document.getElementById('send-chat').addEventListener('click', sendChat);
        function sendChat() {
            const message = document.getElementById('chat-input').value;
            if (message.trim()) {
                const chatMessages = document.getElementById('chat-messages');
                const messageElement = document.createElement('p');
                messageElement.textContent = `${game.currentPlayer}: ${message}`;
                chatMessages.appendChild(messageElement);
                document.getElementById('chat-input').value = '';
            }
        }
    </script>
</body>

</html>